<div class="max-w-fit mx-auto p-10">
  <div class="ms-auto flex items-center justify-between mt-3 mb-8">
    <h1 class="text-4xl font-bold">Dashboard</h1>
    <a [routerLink]="['/create-post']" class="bg-indigo-500 text-white px-4 py-2 rounded">
      Create Mentor
    </a>
  </div>

  <div class="mt-4">
    <div class="grid grid-cols-6 gap-3">
      <app-dashboard-statistics [value]="totalMentors()" [labelDescription]="'Mentors'"></app-dashboard-statistics>
      <app-dashboard-statistics [value]="totalActiveMentors()"
        [labelDescription]="'Total Active'"></app-dashboard-statistics>
      <app-dashboard-statistics [value]="totalInactiveMentors()"
        [labelDescription]="'Total Inactive'"></app-dashboard-statistics>
      <app-dashboard-statistics [value]="totalInProgressMentors()"
        [labelDescription]="'Total In-Progress'"></app-dashboard-statistics>
    </div>
  </div>

  <div class="mt-8">
    <div class="flex justify-between items-center">
      <div class="flex items-center border border-gray-300 rounded-md">
        <input type="search" placeholder="Search..." class="px-4 py-2 focus:outline-none w-[300px]"
          [ngModel]="searchQuery()" (ngModelChange)="onSearchChange($event)" />
      </div>
      <div
        class="flex items-center cursor-pointer gap-2 rounded-full border border-neutral-300 px-4 py-2 text-neutral-700 hover:bg-blue-500 hover:text-white"
        (click)="downloadExcel()">
        <span class="material-symbols-outlined">download</span>
        <span class="text-xs">Download Excel</span>
      </div>
    </div>

    @if(loading){
    <div class="flex justify-center items-center py-10 mt-10">
      <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent border-solid rounded-full animate-spin"></div>
      <span class="ml-3 text-xl text-gray-600">Loading mentors...</span>
    </div>
    }

    @if(!loading){
    <div class="mentors--dat">
      <div class="mt-8 mb-8">
        <table class="table-fixed w-full border-collapse">
          <thead>
            <tr>
              <!-- <th class="px-4 py-2 text-left">Tracking ID</th> -->
              <th class="px-4 py-2 text-left">Profile Image</th>
              <th class="px-4 py-2 text-left">Mentor</th>
              <th class="px-4 py-2 text-left">Program</th>
              <th class="px-4 py-2 text-left">No of Member</th>
              <th class="px-4 py-2 text-left">Date</th>
              <th class="px-4 py-2 text-left">Status</th>
              <th class="px-4 py-2 text-left">Follow Up</th>
              <th class="px-4 py-2 text-left">Action</th>
            </tr>
          </thead>
          <tbody>
            @for(mentorPost of paginatedMentorPosts(); track mentorPost.id){
            <tr class="even:bg-neutral-100">
              <!-- <td class="border border-neutral-100 px-4 py-2">{{mentorPost.id}}</td> -->
              <td class="border border-neutral-100 px-4 py-2">
                <img [src]="mentorPost.profileImageUrl || 'assets/images/default-avatar.png'"
                  class="w-[60px] h-[60px] object-cover rounded-full" [alt]="mentorPost.firstname"
                  (error)="onImageError($event)" />
              </td>
              <td class="border border-neutral-100 px-4 py-2">{{mentorPost.firstname}} {{mentorPost.lastname}}</td>
              <td class="border border-neutral-100 px-4 py-2">{{mentorPost.program}}</td>
              <td class="border border-neutral-100 px-4 py-2">{{mentorPost.numOfMentor}}</td>
              <td class="border border-neutral-100 px-4 py-2">{{convertTimestampToDate(mentorPost.publishedOn) |
                date:'dd-MM-yyyy' }}</td>
              <td class="border border-neutral-100 px-4 py-2">
                <span
                  class="inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset w-30"
                  [class]="getStatusBadgeClass(mentorPost.status)">
                  {{mentorPost.status}}
                </span>
              </td>
              <td class="border border-neutral-100 px-4 py-2">
                @if(isFollowUpDue(mentorPost)){
                <span
                  class="inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset w-fit bg-red-200 text-red-800 ring-gray-500/10">
                  Follow-up needed
                </span>
                }@else {

                <span
                  class="inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset w-fit bg-gray-100 text-gray-600 ring-gray-500/10">
                  @if(getFollowUpDueDate(mentorPost.createdAt, mentorPost.followUpInterval) == undefined){
                  Update the Follow Up Date
                  }@else {
                  Follow-up due on {{ getFollowUpDueDate(mentorPost.createdAt, mentorPost.followUpInterval) |
                  date:'dd-MM-yyyy' }}
                  }

                </span>

                <!-- <span class="inline-flex items-center justify-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset w-fit bg-gray-100 text-gray-600 ring-gray-500/10">
                      Follow-up due on {{ getFollowUpDueDate(mentorPost.createdAt, mentorPost.followUpInterval) | date:'dd-MM-yyyy' }}
                    </span> -->
                }
              </td>
              <td class="border border-neutral-100 px-4 py-2">
                <a [routerLink]="['/edit-post', mentorPost.id]" class="flex items-center">
                  <span class="material-symbols-outlined me-1 text-indigo-500" title="Edit">edit</span> <span
                    class="text-xs text-indigo-500">Edit</span>
                </a>
              </td>
            </tr>
            } @empty {
            <tr>
              <td colspan="8" class="border border-neutral-100 px-4 py-2 text-center">No mentor posts found</td>
            </tr>
            }

          </tbody>
        </table>
      </div>
      <div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6">
        <div class="flex flex-1 justify-between sm:hidden">
          <a href="#" (click)="previousPage(); $event.preventDefault()" [class.opacity-50]="currentPage() === 1"
            class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Previous</a>
          <a href="#" (click)="nextPage(); $event.preventDefault()" [class.opacity-50]="currentPage() === totalPages()"
            class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">Next</a>
        </div>
        <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
          <div>
            <p class="text-sm text-gray-700">
              Showing
              <span class="font-medium">{{ startItem() }}</span>
              to
              <span class="font-medium">{{ endItem() }}</span>
              of
              <span class="font-medium">{{ filteredMentorPosts().length }}</span>
              results
            </p>
          </div>
          <div>
            <nav aria-label="Pagination" class="isolate inline-flex -space-x-px rounded-md shadow-xs">
              <a href="#" (click)="previousPage(); $event.preventDefault()" [class.opacity-50]="currentPage() === 1"
                class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                <span class="sr-only">Previous</span>
                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                  <path
                    d="M11.78 5.22a.75.75 0 0 1 0 1.06L8.06 10l3.72 3.72a.75.75 0 1 1-1.06 1.06l-4.25-4.25a.75.75 0 0 1 0-1.06l4.25-4.25a.75.75 0 0 1 1.06 0Z"
                    clip-rule="evenodd" fill-rule="evenodd" />
                </svg>
              </a>

              <!-- Page numbers -->
              @for(page of pageNumbers(); track trackByPage($index, page)){
              @if(page !== -1){
              <a href="#" (click)="changePage(page); $event.preventDefault()"
                [class.bg-indigo-600]="currentPage() === page" [class.text-white]="currentPage() === page"
                [class.text-gray-900]="currentPage() !== page"
                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                {{ page }}
              </a>
              } @else {
              <span
                class="relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-gray-300 ring-inset focus:outline-offset-0">...</span>
              }
              }

              <a href="#" (click)="nextPage(); $event.preventDefault()"
                [class.opacity-50]="currentPage() === totalPages()"
                class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-gray-300 ring-inset hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                <span class="sr-only">Next</span>
                <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
                  <path
                    d="M8.22 5.22a.75.75 0 0 1 1.06 0l4.25 4.25a.75.75 0 0 1 0 1.06l-4.25 4.25a.75.75 0 0 1-1.06-1.06L11.94 10 8.22 6.28a.75.75 0 0 1 0-1.06Z"
                    clip-rule="evenodd" fill-rule="evenodd" />
                </svg>
              </a>
            </nav>
          </div>
        </div>
      </div>
    </div>
    }

  </div>
</div>